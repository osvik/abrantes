<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abrantes - Alpine.js Integration</title>
    <meta name="description"
        content="How to use Abrantes with Alpine.js: mutate Alpine data, render variants, and keep experiments deterministic.">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <div class="container">
            <a href="index.html" class="logo">Abrantes</a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="examples.html">Examples</a>
                <a href="docs.html">Documentation</a>
                <a href="https://github.com/osvik/abrantes" target="_blank" rel="noreferrer">GitHub</a>
            </div>
        </div>
    </header>

    <main>
        <section class="hero docs-hero">
            <div class="container">
                <h1>Alpine.js integration</h1>
                <p class="subtitle">Two simple patterns based on <a href="https://github.com/osvik/abrantes/blob/main/examples/alpine/1.html" style="color: var(--primary-color);" target="_blank">examples/alpine/1.html</a> and
                    <a href="https://github.com/osvik/abrantes/blob/main/examples/alpine/2.html" style="color: var(--primary-color);" target="_blank">examples/alpine/2.html</a>.</p>
                <div class="cta-group">
                    <a href="experiments.html" class="btn btn-secondary">Experiment basics</a>
                    <a href="examples.html" class="btn btn-secondary">Browse examples</a>
                </div>
            </div>
        </section>

        <section class="features docs-section">
            <div class="container">
                <h2>Load Abrantes and Alpine</h2>
                <div class="feature-card">
                    <p>Load Abrantes first, then Alpine with <code>defer</code>. Place your experiment code after the
                        scripts or in <code>DOMContentLoaded</code>.</p>
                    <pre><code>&lt;script src="AbrantesPlus.js"&gt;&lt;/script&gt;
&lt;script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"&gt;&lt;/script&gt;
&lt;script&gt;
  // experiment code
&lt;/script&gt;
</code></pre>
                </div>
            </div>
        </section>

        <section class="features docs-section">
            <div class="container">
                <h2>Pattern 1: Update Alpine data from variants</h2>
                <div class="feature-card">
                    <p>Use <code>Alpine.$data</code> to mutate component state inside each variant.</p>
                    <pre><code>&lt;div id="alpineBlock1" x-data="{ heading: 'Original', buttonText: 'Click', buttonColor: 'blue' }"&gt;
  &lt;h2 x-text="heading"&gt;&lt;/h2&gt;
  &lt;button x-text="buttonText"&gt;&lt;/button&gt;
&lt;/div&gt;

&lt;script&gt;
document.addEventListener("DOMContentLoaded", function () {
  var block1 = document.querySelector("#alpineBlock1");
  var MyTest = Object.create(Abrantes);

  MyTest.variants = [
    function () {
      Alpine.$data(block1).heading = "MyTest Original";
      Alpine.$data(block1).buttonText = "Original Button";
      Alpine.$data(block1).buttonColor = "blue";
    },
    function () {
      Alpine.$data(block1).heading = "MyTest Variant 1";
      Alpine.$data(block1).buttonText = "Variant Button";
      Alpine.$data(block1).buttonColor = "green";
    }
  ];

  MyTest.assignVariant("MyTest");
  MyTest.renderVariant();
  MyTest.persist("cookie");
  MyTest.add2dataLayer("example_test");
});
&lt;/script&gt;
</code></pre>
                    <p class="doc-callout">This keeps Alpine as the source of truth while Abrantes controls the
                        assignment logic.</p>
                </div>
            </div>
        </section>

        <section class="features docs-section">
            <div class="container">
                <h2>Pattern 2: Let Alpine render variants</h2>
                <div class="feature-card">
                    <p>Expose <code>MyTest.variant</code> to Alpine and render different markup using <code>x-if</code>
                        and <code>x-teleport</code>.</p>
                    <pre><code>&lt;div id="container1"&gt;&lt;/div&gt;

&lt;script&gt;
var MyTest = Object.create(Abrantes);
MyTest.variants = [function () {}, function () {}];
MyTest.assignVariant("MyTest");
MyTest.renderVariant();
MyTest.persist("cookie");
&lt;/script&gt;

&lt;div x-data="{ variant: MyTest.variant === -1 ? 0 : MyTest.variant }"&gt;
  &lt;template x-if="variant === 0"&gt;
    &lt;template x-teleport="#container1"&gt;
      &lt;div&gt;Variant 0 markup&lt;/div&gt;
    &lt;/template&gt;
  &lt;/template&gt;
  &lt;template x-if="variant === 1"&gt;
    &lt;template x-teleport="#container1"&gt;
      &lt;div&gt;Variant 1 markup&lt;/div&gt;
    &lt;/template&gt;
  &lt;/template&gt;
&lt;/div&gt;
</code></pre>
                    <p class="doc-callout">Use a fallback when <code>variant</code> is <code>-1</code> so non-experiment
                        users still see the control.</p>
                </div>
            </div>
        </section>

        <section class="features docs-section">
            <div class="container">
                <h2>Notes</h2>
                <div class="feature-card">
                    <ul class="doc-list">
                        <li>Make sure Alpine is initialized before calling <code>Alpine.$data</code>.</li>
                        <li>Keep the control markup in the base HTML so the page is readable without JS.</li>
                        <li>Call tracking plugins after <code>assignVariant</code> and before analytics config.</li>
                        <li>If you rely on delayed content, use <code>MyTest.waitFor</code> before rendering.</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; Abrantes. Open source software licensed under LGPL-3.0.</p>
            <p>Maintained by <a href="https://github.com/osvik" target="_blank" rel="noreferrer">osvik</a>.</p>
        </div>
    </footer>
</body>

</html>
