<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abrantes - Creating Experiments</title>
    <meta name="description" content="Create experiments with Abrantes: define variants, assign users, persist results, and track outcomes.">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <div class="container">
            <a href="index.html" class="logo">Abrantes</a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="examples.html">Examples</a>
                <a href="docs.html">Documentation</a>
                <a href="https://github.com/osvik/abrantes" target="_blank" rel="noreferrer">GitHub</a>
            </div>
        </div>
    </header>

    <main>
        <section class="hero docs-hero">
            <div class="container">
                <h1>Create experiments</h1>
                <p class="subtitle">Define variants, assign users, render changes, and track results.</p>
                <div class="cta-group">
                    <a href="plugins.html" class="btn btn-secondary">Plugin reference</a>
                    <a href="examples.html" class="btn btn-secondary">View examples</a>
                </div>
            </div>
        </section>

        <section class="features docs-section">
            <div class="container">
                <h2>Basic setup</h2>
                <div class="feature-card">
                    <p>Create a test object, define variants, then assign and render the variant.</p>
                    <pre><code>var MyTest = Object.create(Abrantes);

MyTest.variants = [
  function () { /* control stays as the default page */ },
  function () { document.querySelector(".cta").textContent = "Start free trial"; }
];

MyTest.assignVariant("MyTest");
MyTest.renderVariant();
MyTest.persist("cookie");
</code></pre>
                    <a class="doc-link" href="variants.html">Learn how variant functions work &rarr;</a>
                </div>
            </div>
        </section>

        <section class="features docs-section">
            <div class="container">
                <h2>CSS-only design experiments</h2>
                <div class="feature-card">
                    <p>For visual tweaks, you can let Abrantes add a variant class on <code>&lt;body&gt;</code> and handle
                        the changes in CSS. The class format is <code>{testId}-{variant}</code>, matching the ID you pass
                        to <code>assignVariant</code>.</p>
                    <pre><code>/* CSS scoped to the variant class */
.MyDesignExperiment-1 .hero-title { font-size: 2.5rem; }
.MyDesignExperiment-2 .hero-title { font-size: 1.7rem; }
</code></pre>
                    <pre><code>var MyDesignExperiment = Object.create(Abrantes);
MyDesignExperiment.variants = [
  function () {}, // control
  function () {}, // variant 1
  function () {}  // variant 2
];
MyDesignExperiment.assignVariant("MyDesignExperiment");
MyDesignExperiment.renderVariant();
MyDesignExperiment.persist("cookie");
</code></pre>
                    <ul class="doc-list">
                        <li>Keep the variant functions empty when CSS handles the changes.</li>
                        <li>You can target the control with <code>.MyDesignExperiment-0</code> if needed.</li>
                        <li>Place the CSS in a stylesheet or a <code>&lt;style&gt;</code> block on the page.</li>
                    </ul>
                    <p class="doc-callout">If the user is excluded by segmentation or allocation, <code>assignVariant</code>
                        returns <code>-1</code> and no variant class is added to the page.</p>
                    <a class="doc-link"
                        href="https://github.com/osvik/abrantes/blob/main/examples/design-experiment-1.html"
                        target="_blank" rel="noreferrer">Open design-experiment-1.html &rarr;</a>
                </div>
            </div>
        </section>

        <section class="features docs-section">
            <div class="container">
                <h2>Traffic allocation and segmentation</h2>
                <div class="feature-card">
                    <p>Use the optional parameters in <code>assignVariant</code> to limit traffic or target a segment.</p>
                    <pre><code>MyTest.assignVariant(
  "MyTest", // experiment name
  0.5, // traffic allocation: 50% of users
  () => { return window.innerWidth > 768; } // segment: do the test for only desktop users only
);
</code></pre>
                    <ul class="doc-list">
                        <li>The traffic allocation is a number between <code>0</code> and <code>1</code>.</li>
                        <li><code>segment</code> is a function that returns <code>true</code> or <code>false</code>. If it returns <code>true</code> the user enters the experiment.</li>
                    </ul>
                    <p class="doc-callout">
                        When the user is not in the experiment <code>assignVariant</code> returns <code>-1</code> and the
                        page remains unchanged. Also the user participation in the experiment is not tracked.
                    </p>
                </div>
            </div>
        </section>

        <section class="features docs-section">
            <div class="container">
                <h2>Tracking results</h2>
                <div class="feature-card">
                    <p>Tracking is handled by plugins. You should use the plugins for your tracking tools. Call the plugin method after <code>assignVariant</code>.</p>
                    <pre><code>// Example with the GA4 gtag plugin
MyTest.track("test_event");
</code></pre>
                    <p>You can also:</p>
                    <ul class="doc-list"> 
                        <li>Use the <code>dataLayer</code> to track users if you are using a tag manager. See the <a href="https://github.com/osvik/abrantes/blob/main/examples/add2DL.html#L62-L63" target="_blank">add2DL plugin example</a> for details.</li>
                        <li>Use the <a href="https://github.com/osvik/abrantes/blob/main/examples/log.html#L54-L60" target="_blank">log plugin</a> to capture raw data.</li>
                        <li>Use <a href="https://github.com/osvik/abrantes/blob/main/examples/hotjar.html#L65-L66" target="_blank">Hotjar</a> or <a href="https://github.com/osvik/abrantes/blob/main/examples/clarity.html#L59-L60" target="_blank">Microsoft Clarity</a> to create heatmaps or screen recordings.</li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="features docs-section">
            <div class="container">
                <h2>Testing the experiment</h2>
                <div class="feature-card">
                    <p>1.- Render specific variants using a parameter in the URL by importing instead of assigning:</p>
                    <pre><code>MyTest.importVariant("MyTest");
</code></pre>
                    <p>and load the page with the URL parameter <code>?MyTest=x</code> (where x is the variant number). You can share this URLS with your team or using them to test in mobile phones.</p>
                    <p>2.- Check the pages of the experiment using the <a href="https://github.com/osvik/abrantes-checker-extension" target="_blank">Abrantes checker browser extension</a>.</p>
                    <p>3.- Use the <a href="https://github.com/osvik/abrantes/blob/main/examples/log.html" target="_blank">log plugin</a> and the <a href="https://github.com/osvik/abrantes-log-api" target="_blank">log api</a>to monitor what happens after the experiment is launched.</p>
                </div>
            </div>
        </section>

        <section class="features docs-section">
            <div class="container">
                <h2>Advanced patterns</h2>
                <div class="doc-grid two-col">

                    <div class="feature-card">
                        <h3>Wait for the DOM</h3>
                        <p>For SPAs or delayed content, wait for elements before rendering changes. <code>waitFor</code> should be used in the variant definitions. You can use more than one <code>waitFor</code> in a variant to wait for different elements.</p>
                        <pre><code>function () {
  MyTest.waitFor(".pricing-table", () => {
    document.querySelectorAll(".pricing-table .price").forEach(el => {
    el.textContent = "9.99 €";
    })
  })
}
</code></pre>
                        <a class="doc-link" href="https://github.com/osvik/abrantes/blob/main/examples/waitFor.html#L35-L54" target="_blank">Open waitFor.html &rarr;</a>
                    </div>

                    <div class="feature-card">
                        <h3>Cross-site experiments</h3>
                        <p>Assign the variant in one domain and pass it to another domain .</p>
                        <pre><code>// Landing
MyTest.crossSiteLink("a[data-cross-site]");

// Step 2
MyTest.importVariant("MyTest");
MyTest.renderVariant();
</code></pre>
                        <a class="doc-link" href="https://github.com/osvik/abrantes/blob/main/examples/cross-site/landing.html#L79-L81" target="_blank">Open landing.html →</a><br />
                        <a class="doc-link" href="https://github.com/osvik/abrantes/blob/main/examples/cross-site/step-2.html#L54-L56" target="_blank">Open step-2.html →</a>
                    </div>

                    <div class="feature-card">
                        <h3>Redirect tests</h3>
                        <p>Use different pages for each variant and keep URL parameters.</p>
                        <pre><code>if (MyTest.variant === 1) {
  MyTest.redirectTo("/pricing-v2");
}
</code></pre>
                        <a class="doc-link" href="https://github.com/osvik/abrantes/blob/main/examples/redirect/" target="_blank">Open redirect/ →</a>
                    </div>

                    <div class="feature-card">
                        <h3>Alpine.js integration</h3>
                        <p>Use Alpine state or template rendering to swap variants without fighting reactivity.</p>
                        <a class="doc-link" href="alpine.html">Read the Alpine.js guide &rarr;</a>
                    </div>

                    <div class="feature-card">
                        <h3>Working with iframes</h3>
                        <p>Do experiments with iframes, even with limitations on the JavaScript you can put in them. Some aplications with forms may only allow you to run JS after the form is submitted.</p>
                        <a class="doc-link" href="https://github.com/osvik/abrantes/tree/main/examples/iframes-full-js" target="_blank">Example with full JavaScript &rarr;</a>
                        <a class="doc-link" href="https://github.com/osvik/abrantes/tree/main/examples/iframes-limited" target="_blank">Example with limited JavaScript &rarr;</a>
                    </div>

                    <div class="feature-card">
                        <h3>Seeded experiments</h3>
                        <p>Use when you want to use Abrantes with a fixed seed for reproducible results. It is very useful to create cookieless experiments or cross-device experiments with logged-in users.</p>
                        <p>Seeded experiments have to be inside async functions and can fetch user information from servers.</p>
                        <a class="doc-link" href="https://github.com/osvik/abrantes/blob/main/examples/seed.html#L31-L84" target="_blank">Open seed.html &rarr;</a>
                    </div>

                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; Abrantes. Open source software licensed under LGPL-3.0.</p>
            <p>Maintained by <a href="https://github.com/osvik" target="_blank" rel="noreferrer">osvik</a>.</p>
        </div>
    </footer>
</body>

</html>
